function $(/* args */) {
    let root = document;
    let query = arguments[0];
    if (arguments[0] instanceof Element || arguments[0] instanceof DocumentFragment) {
        root = arguments[0];
        query = arguments[1];
    }
    return root.querySelector(query);
}

function svg(type) {
    return document.createElementNS('http://www.w3.org/2000/svg', type);
}

// Utility

// Draws the animation panel attached to the given app view
function drawAnimations(animations, app) {
    const animationsView = app.querySelector("#animations");
    const keyframeView = app.querySelector("#keyframe");

    animationsView.innerHTML = "";
    for (let animation of animations) {
        const li = document.createElement('li');
        drawAnimation(li, animation);
        animationsView.appendChild(li);
    }

    // Drawing animation keyframes
    function drawAnimation(parentElement, animation) {
        // copy template for foo.
        let elem = $('#animation_template').content.cloneNode(true);
        // $(elem,'.timing').innerHTML=`<div class="timings">${JSON.stringify(animation.effect.getTiming())}</div>`
        const keyframesViewSVG = $(elem, '.keyframes svg');

        const keyframes = animation.effect.getKeyframes();
        for (let i = 0; i < keyframes.length; i++) {
            const keyframe = keyframes[i];
            const x1 = `${keyframe.computedOffset * 100}%`;
            if (i < keyframes.length - 1) {
                const x2 = `${keyframes[i + 1].computedOffset * 100}%`;
                drawLine(x1, x2);
            }
            const circle = drawCircle(x1);

            circle.addEventListener('click', (evt) => {
                //evt.target.classList.add('selected');
                showKeyframe(keyframe);
            });
        }
        parentElement.appendChild(elem);

        function drawCircle(x) {
            const circle = svg('circle');
            circle.classList.add('my-class');
            circle.setAttribute('cx', x);
            circle.setAttribute('cy', 10);
            circle.style.stroke = 'blue';
            circle.style.fill = 'blue';

            circle.setAttribute('r', 5);
            keyframesViewSVG.appendChild(circle);
            return circle;
        }

        function drawLine(x1, x2) {
            const line = svg('line');
            line.setAttribute('x1', x1);
            line.setAttribute('x2', x2);
            line.setAttribute('y1', 10);
            line.setAttribute('y2', 10);
            line.setAttribute('x1', x1);
            line.style.stroke = 'lightblue';
            line.style.strokeWidth = 2;

            keyframesViewSVG.appendChild(line);
            return line;
        }
    }

    function showKeyframe(keyframe) {
        keyframeView.innerHTML = `
        <tt>${keyframe.computedOffset * 100}% - ${keyframe.transform}</tt>`;
        console.log(keyframe);
    }
}

// Draws the timeline
function drawTimeline(animations, app) {
    const timeline = app.querySelector("#timeline");
    const play = app.querySelector("#play");

    requestAnimationFrame(updateTimeline);
    console.log(animations);

    timeline.addEventListener('input', function (evt) {
        const progress = evt.target.value;
        updateCurrentTime(parseInt(progress));
    });

    play.addEventListener('click', function (evt) {
        let animation = animations[0]; // Bit hacky
        updatePlayState(animation.playState == 'paused');
    });

    function updatePlayState(shouldPlay) {
        let animation = animations[0]; // Bit hacky
        if ((animation.playState != 'paused') == shouldPlay)
            return;
        if (shouldPlay) {
            for (let anim of animations)
                anim.play();
            play.value = "Pause ⏸";
            updateTimeline(document.timeline.currentTime);
        } else {
            for (let anim of animations)
                anim.pause();
            play.value = "Play ▶️";
        }
    }

    function updateTimeline(frameTime) {
        // Update timeline to current time
        let animation = animations[0]; // Bit hacky
        if (animation.playState == 'paused')
            return;
        const duration = animation.effect.getTiming().duration;
        timeline.value = (animation.currentTime % duration) * 100 / duration;
        requestAnimationFrame(updateTimeline);
    }

    // progress is between 0-100
    function updateCurrentTime(progress) {
        updatePlayState(false);
        for (let animation of animations) {
            // TODO: Use finite time length and allow extending animations.
            const duration = animation.effect.getTiming().duration;
            animation.currentTime = duration * progress / 100;
        }
    }
}

// Setup
// Animate content to have a running sample to work with

const sandbox = document.querySelector("#sandbox");
for (let box of sandbox.querySelectorAll(".box")) {
  box.animate(
      { transform : ['translateX(-100px)','translateX(100px)'] },
      {
          duration: 3000,
          iterations: Infinity // TODO: try infinity
      });
}

main();

// Actual app code
function main() {
  const app = document.querySelector("#app");
  if (!document.getAnimations) {
    app.innerHTML=`
      <section>
        <h2>Error</h2>
        Your browser does not support <tt>document.getAnimations()</tt> 
        API. In Chrome you can enable it by activating the follwing flag:
        <tt>chrome://flags/#enable-experimental-web-platform-features</tt>  
      </section>`;
    return;
  }


  const animations = document.getAnimations({ subtree: true });

  drawTimeline(animations, app);

  function updateAnimations() {
    drawAnimations(animations, app);
  }
  updateAnimations();

  // TODO: Move selection logic into its own component 
  let selectedElement;
  let targetedElement;
  const EPSILON = 0.001;

  function dragStart(evt) {
    evt.stopPropagation();
    // TODO: Get the animation from animations associated with evt.target
    let animation = evt.target.getAnimations()[0];
    // Get a keyframe for the current time
    const duration = animation.effect.getTiming().duration;
    let currentOffset = ((animation.currentTime % duration)/ duration);
    let keyframes = animation.effect.getKeyframes();
    let keyframe;
    let currentTransform = getComputedStyle(evt.target).transform;
    for (let index = 0; index < keyframes.length; index++) {
      // TODO: Find existing keyframe near currentOffset
      if (Math.abs(keyframes[index].computedOffset - currentOffset) < EPSILON) {
        keyframe = keyframes[index];
        break;
      } else if (keyframes[index].computedOffset > currentOffset) {
        // Insert new keyframe before index.
        keyframe = {
          offset: currentOffset,
        };
        keyframes.splice(index, 0, keyframe);
        break;
      }
    }

    let start = [evt.clientX, evt.clientY];
    console.log(evt);
    function dragMove(evt) {
      let delta = [evt.clientX - start[0], evt.clientY - start[1]];
      keyframe.transform = 'translate(' + delta[0] + 'px, ' + delta[1] + 'px) ' + currentTransform;
      animation.effect.setKeyframes(keyframes);
      updateAnimations();
    }

    function dragEnd(evt) {
      console.log(evt);
      evt.target.removeEventListener('pointermove', dragMove);
      evt.target.removeEventListener('pointercancel', dragEnd);
      evt.target.removeEventListener('pointerup', dragEnd);
      evt.target.releasePointerCapture(evt.pointerId);
    }
    evt.target.addEventListener('pointermove', dragMove);
    evt.target.addEventListener('pointercancel', dragEnd);
    evt.target.addEventListener('pointerup', dragEnd);
    evt.target.setPointerCapture(evt.pointerId);
  }

  function isAncestor(ancestor, node) {
    while (node && node != ancestor) {
      node = node.parentNode;
    }
    return node;
  }

  function selectElement(element) {
    if (targetedElement) {
      targetedElement.removeEventListener('pointerdown', dragStart);
      targetedElement.style.outline = '';
    }
    if (selectedElement) {
      if (!isAncestor(element, selectedElement))
        selectedElement = element;
    } else {
      selectedElement = element;
    }
    targetedElement = element;
    // Find the nearest ancestor with animations.
    // TODO: Allow creating animations on new nodes.
    while (targetedElement && targetedElement.getAnimations().length == 0)
      targetedElement = targetedElement.parentElement;
    if (targetedElement) {
      targetedElement.addEventListener('pointerdown', dragStart);
      targetedElement.style.outline = '1px solid blue';
    }
    let parents = $('#element-selector');
    // Remove all children
    parents.innerHTML = '';
    let cur = selectedElement;
    while (cur) {
      let elem = $('#element-item').cloneNode(true).content;
      elem.addEventListener('click', selectElement.bind(null, elem));
      $(elem, '.name').textContent = cur.tagName;
      if (cur == targetedElement) {
        $(elem, '.name').style.fontWeight = 'bold';
      }
      parents.appendChild(elem);
      cur = cur.parentElement;
    }
  }

  document.addEventListener('pointerdown', (evt) => {
    evt.stopPropagation();
    selectElement(evt.target);
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVuZGxlLmpzIiwic291cmNlcyI6WyJqcy91dGlscy5qcyIsImpzL2FuaW1hdGlvbnMuanMiLCJqcy90aW1lbGluZS5qcyIsImpzL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlxuXG5leHBvcnQgZnVuY3Rpb24gJCgvKiBhcmdzICovKSB7XG4gICAgbGV0IHJvb3QgPSBkb2N1bWVudDtcbiAgICBsZXQgcXVlcnkgPSBhcmd1bWVudHNbMF07XG4gICAgaWYgKGFyZ3VtZW50c1swXSBpbnN0YW5jZW9mIEVsZW1lbnQgfHwgYXJndW1lbnRzWzBdIGluc3RhbmNlb2YgRG9jdW1lbnRGcmFnbWVudCkge1xuICAgICAgICByb290ID0gYXJndW1lbnRzWzBdO1xuICAgICAgICBxdWVyeSA9IGFyZ3VtZW50c1sxXTtcbiAgICB9XG4gICAgcmV0dXJuIHJvb3QucXVlcnlTZWxlY3RvcihxdWVyeSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzdmcodHlwZSkge1xuICAgIHJldHVybiBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJywgdHlwZSk7XG59IiwiLy8gVXRpbGl0eVxuaW1wb3J0IHsgJCwgc3ZnIH0gZnJvbSAnLi91dGlscy5qcycgXG5cbi8vIERyYXdzIHRoZSBhbmltYXRpb24gcGFuZWwgYXR0YWNoZWQgdG8gdGhlIGdpdmVuIGFwcCB2aWV3XG5leHBvcnQgZnVuY3Rpb24gZHJhd0FuaW1hdGlvbnMoYW5pbWF0aW9ucywgYXBwKSB7XG4gICAgY29uc3QgYW5pbWF0aW9uc1ZpZXcgPSBhcHAucXVlcnlTZWxlY3RvcihcIiNhbmltYXRpb25zXCIpO1xuICAgIGNvbnN0IGtleWZyYW1lVmlldyA9IGFwcC5xdWVyeVNlbGVjdG9yKFwiI2tleWZyYW1lXCIpO1xuXG4gICAgYW5pbWF0aW9uc1ZpZXcuaW5uZXJIVE1MID0gXCJcIjtcbiAgICBmb3IgKGxldCBhbmltYXRpb24gb2YgYW5pbWF0aW9ucykge1xuICAgICAgICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG4gICAgICAgIGRyYXdBbmltYXRpb24obGksIGFuaW1hdGlvbik7XG4gICAgICAgIGFuaW1hdGlvbnNWaWV3LmFwcGVuZENoaWxkKGxpKTtcbiAgICB9XG5cbiAgICAvLyBEcmF3aW5nIGFuaW1hdGlvbiBrZXlmcmFtZXNcbiAgICBmdW5jdGlvbiBkcmF3QW5pbWF0aW9uKHBhcmVudEVsZW1lbnQsIGFuaW1hdGlvbikge1xuICAgICAgICAvLyBjb3B5IHRlbXBsYXRlIGZvciBmb28uXG4gICAgICAgIGxldCBlbGVtID0gJCgnI2FuaW1hdGlvbl90ZW1wbGF0ZScpLmNvbnRlbnQuY2xvbmVOb2RlKHRydWUpO1xuICAgICAgICAvLyAkKGVsZW0sJy50aW1pbmcnKS5pbm5lckhUTUw9YDxkaXYgY2xhc3M9XCJ0aW1pbmdzXCI+JHtKU09OLnN0cmluZ2lmeShhbmltYXRpb24uZWZmZWN0LmdldFRpbWluZygpKX08L2Rpdj5gXG4gICAgICAgIGNvbnN0IGtleWZyYW1lc1ZpZXdTVkcgPSAkKGVsZW0sICcua2V5ZnJhbWVzIHN2ZycpO1xuXG4gICAgICAgIGNvbnN0IGtleWZyYW1lcyA9IGFuaW1hdGlvbi5lZmZlY3QuZ2V0S2V5ZnJhbWVzKCk7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwga2V5ZnJhbWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBrZXlmcmFtZSA9IGtleWZyYW1lc1tpXTtcbiAgICAgICAgICAgIGNvbnN0IHgxID0gYCR7a2V5ZnJhbWUuY29tcHV0ZWRPZmZzZXQgKiAxMDB9JWA7XG4gICAgICAgICAgICBpZiAoaSA8IGtleWZyYW1lcy5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgeDIgPSBgJHtrZXlmcmFtZXNbaSArIDFdLmNvbXB1dGVkT2Zmc2V0ICogMTAwfSVgXG4gICAgICAgICAgICAgICAgZHJhd0xpbmUoeDEsIHgyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGNpcmNsZSA9IGRyYXdDaXJjbGUoeDEpO1xuXG4gICAgICAgICAgICBjaXJjbGUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXZ0KSA9PiB7XG4gICAgICAgICAgICAgICAgLy9ldnQudGFyZ2V0LmNsYXNzTGlzdC5hZGQoJ3NlbGVjdGVkJyk7XG4gICAgICAgICAgICAgICAgc2hvd0tleWZyYW1lKGtleWZyYW1lKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHBhcmVudEVsZW1lbnQuYXBwZW5kQ2hpbGQoZWxlbSk7XG5cbiAgICAgICAgZnVuY3Rpb24gZHJhd0NpcmNsZSh4KSB7XG4gICAgICAgICAgICBjb25zdCBjaXJjbGUgPSBzdmcoJ2NpcmNsZScpO1xuICAgICAgICAgICAgY2lyY2xlLmNsYXNzTGlzdC5hZGQoJ215LWNsYXNzJyk7XG4gICAgICAgICAgICBjaXJjbGUuc2V0QXR0cmlidXRlKCdjeCcsIHgpO1xuICAgICAgICAgICAgY2lyY2xlLnNldEF0dHJpYnV0ZSgnY3knLCAxMCk7XG4gICAgICAgICAgICBjaXJjbGUuc3R5bGUuc3Ryb2tlID0gJ2JsdWUnO1xuICAgICAgICAgICAgY2lyY2xlLnN0eWxlLmZpbGwgPSAnYmx1ZSc7XG5cbiAgICAgICAgICAgIGNpcmNsZS5zZXRBdHRyaWJ1dGUoJ3InLCA1KTtcbiAgICAgICAgICAgIGtleWZyYW1lc1ZpZXdTVkcuYXBwZW5kQ2hpbGQoY2lyY2xlKTtcbiAgICAgICAgICAgIHJldHVybiBjaXJjbGU7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBkcmF3TGluZSh4MSwgeDIpIHtcbiAgICAgICAgICAgIGNvbnN0IGxpbmUgPSBzdmcoJ2xpbmUnKTtcbiAgICAgICAgICAgIGxpbmUuc2V0QXR0cmlidXRlKCd4MScsIHgxKTtcbiAgICAgICAgICAgIGxpbmUuc2V0QXR0cmlidXRlKCd4MicsIHgyKTtcbiAgICAgICAgICAgIGxpbmUuc2V0QXR0cmlidXRlKCd5MScsIDEwKTtcbiAgICAgICAgICAgIGxpbmUuc2V0QXR0cmlidXRlKCd5MicsIDEwKTtcbiAgICAgICAgICAgIGxpbmUuc2V0QXR0cmlidXRlKCd4MScsIHgxKTtcbiAgICAgICAgICAgIGxpbmUuc3R5bGUuc3Ryb2tlID0gJ2xpZ2h0Ymx1ZSc7XG4gICAgICAgICAgICBsaW5lLnN0eWxlLnN0cm9rZVdpZHRoID0gMjtcblxuICAgICAgICAgICAga2V5ZnJhbWVzVmlld1NWRy5hcHBlbmRDaGlsZChsaW5lKTtcbiAgICAgICAgICAgIHJldHVybiBsaW5lO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc2hvd0tleWZyYW1lKGtleWZyYW1lKSB7XG4gICAgICAgIGtleWZyYW1lVmlldy5pbm5lckhUTUwgPSBgXG4gICAgICAgIDx0dD4ke2tleWZyYW1lLmNvbXB1dGVkT2Zmc2V0ICogMTAwfSUgLSAke2tleWZyYW1lLnRyYW5zZm9ybX08L3R0PmA7XG4gICAgICAgIGNvbnNvbGUubG9nKGtleWZyYW1lKTtcbiAgICB9XG59XG4iLCIvLyBEcmF3cyB0aGUgdGltZWxpbmVcbmV4cG9ydCBmdW5jdGlvbiBkcmF3VGltZWxpbmUoYW5pbWF0aW9ucywgYXBwKSB7XG4gICAgY29uc3QgdGltZWxpbmUgPSBhcHAucXVlcnlTZWxlY3RvcihcIiN0aW1lbGluZVwiKTtcbiAgICBjb25zdCBwbGF5ID0gYXBwLnF1ZXJ5U2VsZWN0b3IoXCIjcGxheVwiKTtcblxuICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSh1cGRhdGVUaW1lbGluZSk7XG4gICAgY29uc29sZS5sb2coYW5pbWF0aW9ucyk7XG5cbiAgICB0aW1lbGluZS5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIGZ1bmN0aW9uIChldnQpIHtcbiAgICAgICAgY29uc3QgcHJvZ3Jlc3MgPSBldnQudGFyZ2V0LnZhbHVlO1xuICAgICAgICB1cGRhdGVDdXJyZW50VGltZShwYXJzZUludChwcm9ncmVzcykpXG4gICAgfSk7XG5cbiAgICBwbGF5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGV2dCkge1xuICAgICAgICBsZXQgYW5pbWF0aW9uID0gYW5pbWF0aW9uc1swXTsgLy8gQml0IGhhY2t5XG4gICAgICAgIHVwZGF0ZVBsYXlTdGF0ZShhbmltYXRpb24ucGxheVN0YXRlID09ICdwYXVzZWQnKTtcbiAgICB9KTtcblxuICAgIGZ1bmN0aW9uIHVwZGF0ZVBsYXlTdGF0ZShzaG91bGRQbGF5KSB7XG4gICAgICAgIGxldCBhbmltYXRpb24gPSBhbmltYXRpb25zWzBdOyAvLyBCaXQgaGFja3lcbiAgICAgICAgaWYgKChhbmltYXRpb24ucGxheVN0YXRlICE9ICdwYXVzZWQnKSA9PSBzaG91bGRQbGF5KVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBpZiAoc2hvdWxkUGxheSkge1xuICAgICAgICAgICAgZm9yIChsZXQgYW5pbSBvZiBhbmltYXRpb25zKVxuICAgICAgICAgICAgICAgIGFuaW0ucGxheSgpO1xuICAgICAgICAgICAgcGxheS52YWx1ZSA9IFwiUGF1c2Ug4o+4XCI7XG4gICAgICAgICAgICB1cGRhdGVUaW1lbGluZShkb2N1bWVudC50aW1lbGluZS5jdXJyZW50VGltZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBmb3IgKGxldCBhbmltIG9mIGFuaW1hdGlvbnMpXG4gICAgICAgICAgICAgICAgYW5pbS5wYXVzZSgpO1xuICAgICAgICAgICAgcGxheS52YWx1ZSA9IFwiUGxheSDilrbvuI9cIjtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIHVwZGF0ZVRpbWVsaW5lKGZyYW1lVGltZSkge1xuICAgICAgICAvLyBVcGRhdGUgdGltZWxpbmUgdG8gY3VycmVudCB0aW1lXG4gICAgICAgIGxldCBhbmltYXRpb24gPSBhbmltYXRpb25zWzBdOyAvLyBCaXQgaGFja3lcbiAgICAgICAgaWYgKGFuaW1hdGlvbi5wbGF5U3RhdGUgPT0gJ3BhdXNlZCcpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGNvbnN0IGR1cmF0aW9uID0gYW5pbWF0aW9uLmVmZmVjdC5nZXRUaW1pbmcoKS5kdXJhdGlvbjtcbiAgICAgICAgdGltZWxpbmUudmFsdWUgPSAoYW5pbWF0aW9uLmN1cnJlbnRUaW1lICUgZHVyYXRpb24pICogMTAwIC8gZHVyYXRpb247XG4gICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSh1cGRhdGVUaW1lbGluZSk7XG4gICAgfVxuXG4gICAgLy8gcHJvZ3Jlc3MgaXMgYmV0d2VlbiAwLTEwMFxuICAgIGZ1bmN0aW9uIHVwZGF0ZUN1cnJlbnRUaW1lKHByb2dyZXNzKSB7XG4gICAgICAgIHVwZGF0ZVBsYXlTdGF0ZShmYWxzZSk7XG4gICAgICAgIGZvciAobGV0IGFuaW1hdGlvbiBvZiBhbmltYXRpb25zKSB7XG4gICAgICAgICAgICAvLyBUT0RPOiBVc2UgZmluaXRlIHRpbWUgbGVuZ3RoIGFuZCBhbGxvdyBleHRlbmRpbmcgYW5pbWF0aW9ucy5cbiAgICAgICAgICAgIGNvbnN0IGR1cmF0aW9uID0gYW5pbWF0aW9uLmVmZmVjdC5nZXRUaW1pbmcoKS5kdXJhdGlvbjtcbiAgICAgICAgICAgIGFuaW1hdGlvbi5jdXJyZW50VGltZSA9IGR1cmF0aW9uICogcHJvZ3Jlc3MgLyAxMDA7XG4gICAgICAgIH1cbiAgICB9XG59IiwiJ3VzZSBzdHJpY3QnO1xuLy8gaW1wb3J0IFdoYXRldmVyIGZyb20gJ2h0dHBzOi8vdW5wa2cuY29tL3doYXRldmVyJ1xuLy8gaW1wb3J0IFdoYXRldmVyIGZyb20gJ3doYXRldmVyJ1xuLy8gaW1wb3J0IHsgZGVmYXVsdCBhcyBpbmRleF9jc3MgfSAgZnJvbSAnLi9jc3MvaW5kZXguY3NzJ1xuXG4vLyBVdGlsaXR5XG5pbXBvcnQgeyQsIHN2Z30gZnJvbSAnLi91dGlscy5qcydcblxuLy8gQ29tcG9uZW50c1xuaW1wb3J0IHsgZHJhd0FuaW1hdGlvbnMgfSBmcm9tICcuL2FuaW1hdGlvbnMuanMnXG5pbXBvcnQgeyBkcmF3VGltZWxpbmUgfSBmcm9tICcuL3RpbWVsaW5lLmpzJztcblxuXG4vLyBTZXR1cFxuLy8gQW5pbWF0ZSBjb250ZW50IHRvIGhhdmUgYSBydW5uaW5nIHNhbXBsZSB0byB3b3JrIHdpdGhcblxuY29uc3Qgc2FuZGJveCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjc2FuZGJveFwiKTtcbmZvciAobGV0IGJveCBvZiBzYW5kYm94LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuYm94XCIpKSB7XG4gIGJveC5hbmltYXRlKFxuICAgICAgeyB0cmFuc2Zvcm0gOiBbJ3RyYW5zbGF0ZVgoLTEwMHB4KScsJ3RyYW5zbGF0ZVgoMTAwcHgpJ10gfSxcbiAgICAgIHtcbiAgICAgICAgICBkdXJhdGlvbjogMzAwMCxcbiAgICAgICAgICBpdGVyYXRpb25zOiBJbmZpbml0eSAvLyBUT0RPOiB0cnkgaW5maW5pdHlcbiAgICAgIH0pO1xufVxuXG5tYWluKCk7XG5cbi8vIEFjdHVhbCBhcHAgY29kZVxuZnVuY3Rpb24gbWFpbigpIHtcbiAgY29uc3QgYXBwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNhcHBcIik7XG4gIGlmICghZG9jdW1lbnQuZ2V0QW5pbWF0aW9ucykge1xuICAgIGFwcC5pbm5lckhUTUw9YFxuICAgICAgPHNlY3Rpb24+XG4gICAgICAgIDxoMj5FcnJvcjwvaDI+XG4gICAgICAgIFlvdXIgYnJvd3NlciBkb2VzIG5vdCBzdXBwb3J0IDx0dD5kb2N1bWVudC5nZXRBbmltYXRpb25zKCk8L3R0PiBcbiAgICAgICAgQVBJLiBJbiBDaHJvbWUgeW91IGNhbiBlbmFibGUgaXQgYnkgYWN0aXZhdGluZyB0aGUgZm9sbHdpbmcgZmxhZzpcbiAgICAgICAgPHR0PmNocm9tZTovL2ZsYWdzLyNlbmFibGUtZXhwZXJpbWVudGFsLXdlYi1wbGF0Zm9ybS1mZWF0dXJlczwvdHQ+ICBcbiAgICAgIDwvc2VjdGlvbj5gO1xuICAgIHJldHVybjtcbiAgfVxuXG5cbiAgY29uc3QgYW5pbWF0aW9ucyA9IGRvY3VtZW50LmdldEFuaW1hdGlvbnMoeyBzdWJ0cmVlOiB0cnVlIH0pO1xuXG4gIGRyYXdUaW1lbGluZShhbmltYXRpb25zLCBhcHApO1xuXG4gIGZ1bmN0aW9uIHVwZGF0ZUFuaW1hdGlvbnMoKSB7XG4gICAgZHJhd0FuaW1hdGlvbnMoYW5pbWF0aW9ucywgYXBwKTtcbiAgfVxuICB1cGRhdGVBbmltYXRpb25zKCk7XG5cbiAgLy8gVE9ETzogTW92ZSBzZWxlY3Rpb24gbG9naWMgaW50byBpdHMgb3duIGNvbXBvbmVudCBcbiAgbGV0IHNlbGVjdGVkRWxlbWVudDtcbiAgbGV0IHRhcmdldGVkRWxlbWVudDtcbiAgY29uc3QgRVBTSUxPTiA9IDAuMDAxO1xuXG4gIGZ1bmN0aW9uIGRyYWdTdGFydChldnQpIHtcbiAgICBldnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgLy8gVE9ETzogR2V0IHRoZSBhbmltYXRpb24gZnJvbSBhbmltYXRpb25zIGFzc29jaWF0ZWQgd2l0aCBldnQudGFyZ2V0XG4gICAgbGV0IGFuaW1hdGlvbiA9IGV2dC50YXJnZXQuZ2V0QW5pbWF0aW9ucygpWzBdO1xuICAgIC8vIEdldCBhIGtleWZyYW1lIGZvciB0aGUgY3VycmVudCB0aW1lXG4gICAgY29uc3QgZHVyYXRpb24gPSBhbmltYXRpb24uZWZmZWN0LmdldFRpbWluZygpLmR1cmF0aW9uO1xuICAgIGxldCBjdXJyZW50T2Zmc2V0ID0gKChhbmltYXRpb24uY3VycmVudFRpbWUgJSBkdXJhdGlvbikvIGR1cmF0aW9uKTtcbiAgICBsZXQga2V5ZnJhbWVzID0gYW5pbWF0aW9uLmVmZmVjdC5nZXRLZXlmcmFtZXMoKTtcbiAgICBsZXQga2V5ZnJhbWU7XG4gICAgbGV0IGN1cnJlbnRUcmFuc2Zvcm0gPSBnZXRDb21wdXRlZFN0eWxlKGV2dC50YXJnZXQpLnRyYW5zZm9ybTtcbiAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwga2V5ZnJhbWVzLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgLy8gVE9ETzogRmluZCBleGlzdGluZyBrZXlmcmFtZSBuZWFyIGN1cnJlbnRPZmZzZXRcbiAgICAgIGlmIChNYXRoLmFicyhrZXlmcmFtZXNbaW5kZXhdLmNvbXB1dGVkT2Zmc2V0IC0gY3VycmVudE9mZnNldCkgPCBFUFNJTE9OKSB7XG4gICAgICAgIGtleWZyYW1lID0ga2V5ZnJhbWVzW2luZGV4XTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9IGVsc2UgaWYgKGtleWZyYW1lc1tpbmRleF0uY29tcHV0ZWRPZmZzZXQgPiBjdXJyZW50T2Zmc2V0KSB7XG4gICAgICAgIC8vIEluc2VydCBuZXcga2V5ZnJhbWUgYmVmb3JlIGluZGV4LlxuICAgICAgICBrZXlmcmFtZSA9IHtcbiAgICAgICAgICBvZmZzZXQ6IGN1cnJlbnRPZmZzZXQsXG4gICAgICAgIH07XG4gICAgICAgIGtleWZyYW1lcy5zcGxpY2UoaW5kZXgsIDAsIGtleWZyYW1lKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuXG4gICAgbGV0IHN0YXJ0ID0gW2V2dC5jbGllbnRYLCBldnQuY2xpZW50WV07XG4gICAgY29uc29sZS5sb2coZXZ0KTtcbiAgICBmdW5jdGlvbiBkcmFnTW92ZShldnQpIHtcbiAgICAgIGxldCBkZWx0YSA9IFtldnQuY2xpZW50WCAtIHN0YXJ0WzBdLCBldnQuY2xpZW50WSAtIHN0YXJ0WzFdXTtcbiAgICAgIGtleWZyYW1lLnRyYW5zZm9ybSA9ICd0cmFuc2xhdGUoJyArIGRlbHRhWzBdICsgJ3B4LCAnICsgZGVsdGFbMV0gKyAncHgpICcgKyBjdXJyZW50VHJhbnNmb3JtO1xuICAgICAgYW5pbWF0aW9uLmVmZmVjdC5zZXRLZXlmcmFtZXMoa2V5ZnJhbWVzKTtcbiAgICAgIHVwZGF0ZUFuaW1hdGlvbnMoKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBkcmFnRW5kKGV2dCkge1xuICAgICAgY29uc29sZS5sb2coZXZ0KTtcbiAgICAgIGV2dC50YXJnZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9pbnRlcm1vdmUnLCBkcmFnTW92ZSk7XG4gICAgICBldnQudGFyZ2V0LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3BvaW50ZXJjYW5jZWwnLCBkcmFnRW5kKTtcbiAgICAgIGV2dC50YXJnZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9pbnRlcnVwJywgZHJhZ0VuZCk7XG4gICAgICBldnQudGFyZ2V0LnJlbGVhc2VQb2ludGVyQ2FwdHVyZShldnQucG9pbnRlcklkKTtcbiAgICB9XG4gICAgZXZ0LnRhcmdldC5hZGRFdmVudExpc3RlbmVyKCdwb2ludGVybW92ZScsIGRyYWdNb3ZlKTtcbiAgICBldnQudGFyZ2V0LmFkZEV2ZW50TGlzdGVuZXIoJ3BvaW50ZXJjYW5jZWwnLCBkcmFnRW5kKTtcbiAgICBldnQudGFyZ2V0LmFkZEV2ZW50TGlzdGVuZXIoJ3BvaW50ZXJ1cCcsIGRyYWdFbmQpO1xuICAgIGV2dC50YXJnZXQuc2V0UG9pbnRlckNhcHR1cmUoZXZ0LnBvaW50ZXJJZCk7XG4gIH1cblxuICBmdW5jdGlvbiBpc0FuY2VzdG9yKGFuY2VzdG9yLCBub2RlKSB7XG4gICAgd2hpbGUgKG5vZGUgJiYgbm9kZSAhPSBhbmNlc3Rvcikge1xuICAgICAgbm9kZSA9IG5vZGUucGFyZW50Tm9kZTtcbiAgICB9XG4gICAgcmV0dXJuIG5vZGU7XG4gIH1cblxuICBmdW5jdGlvbiBzZWxlY3RFbGVtZW50KGVsZW1lbnQpIHtcbiAgICBpZiAodGFyZ2V0ZWRFbGVtZW50KSB7XG4gICAgICB0YXJnZXRlZEVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9pbnRlcmRvd24nLCBkcmFnU3RhcnQpO1xuICAgICAgdGFyZ2V0ZWRFbGVtZW50LnN0eWxlLm91dGxpbmUgPSAnJztcbiAgICB9XG4gICAgaWYgKHNlbGVjdGVkRWxlbWVudCkge1xuICAgICAgaWYgKCFpc0FuY2VzdG9yKGVsZW1lbnQsIHNlbGVjdGVkRWxlbWVudCkpXG4gICAgICAgIHNlbGVjdGVkRWxlbWVudCA9IGVsZW1lbnQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNlbGVjdGVkRWxlbWVudCA9IGVsZW1lbnQ7XG4gICAgfVxuICAgIHRhcmdldGVkRWxlbWVudCA9IGVsZW1lbnQ7XG4gICAgLy8gRmluZCB0aGUgbmVhcmVzdCBhbmNlc3RvciB3aXRoIGFuaW1hdGlvbnMuXG4gICAgLy8gVE9ETzogQWxsb3cgY3JlYXRpbmcgYW5pbWF0aW9ucyBvbiBuZXcgbm9kZXMuXG4gICAgd2hpbGUgKHRhcmdldGVkRWxlbWVudCAmJiB0YXJnZXRlZEVsZW1lbnQuZ2V0QW5pbWF0aW9ucygpLmxlbmd0aCA9PSAwKVxuICAgICAgdGFyZ2V0ZWRFbGVtZW50ID0gdGFyZ2V0ZWRFbGVtZW50LnBhcmVudEVsZW1lbnQ7XG4gICAgaWYgKHRhcmdldGVkRWxlbWVudCkge1xuICAgICAgdGFyZ2V0ZWRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3BvaW50ZXJkb3duJywgZHJhZ1N0YXJ0KTtcbiAgICAgIHRhcmdldGVkRWxlbWVudC5zdHlsZS5vdXRsaW5lID0gJzFweCBzb2xpZCBibHVlJztcbiAgICB9XG4gICAgbGV0IHBhcmVudHMgPSAkKCcjZWxlbWVudC1zZWxlY3RvcicpO1xuICAgIC8vIFJlbW92ZSBhbGwgY2hpbGRyZW5cbiAgICBwYXJlbnRzLmlubmVySFRNTCA9ICcnO1xuICAgIGxldCBjdXIgPSBzZWxlY3RlZEVsZW1lbnQ7XG4gICAgd2hpbGUgKGN1cikge1xuICAgICAgbGV0IGVsZW0gPSAkKCcjZWxlbWVudC1pdGVtJykuY2xvbmVOb2RlKHRydWUpLmNvbnRlbnQ7XG4gICAgICBlbGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc2VsZWN0RWxlbWVudC5iaW5kKG51bGwsIGVsZW0pKTtcbiAgICAgICQoZWxlbSwgJy5uYW1lJykudGV4dENvbnRlbnQgPSBjdXIudGFnTmFtZTtcbiAgICAgIGlmIChjdXIgPT0gdGFyZ2V0ZWRFbGVtZW50KSB7XG4gICAgICAgICQoZWxlbSwgJy5uYW1lJykuc3R5bGUuZm9udFdlaWdodCA9ICdib2xkJztcbiAgICAgIH1cbiAgICAgIHBhcmVudHMuYXBwZW5kQ2hpbGQoZWxlbSk7XG4gICAgICBjdXIgPSBjdXIucGFyZW50RWxlbWVudDtcbiAgICB9XG4gIH1cblxuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdwb2ludGVyZG93bicsIChldnQpID0+IHtcbiAgICBldnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgc2VsZWN0RWxlbWVudChldnQudGFyZ2V0KTtcbiAgfSk7XG59XG5cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFTyxTQUFTLENBQUMsYUFBYTtBQUM5QixJQUFJLElBQUksSUFBSSxHQUFHLFFBQVEsQ0FBQztBQUN4QixJQUFJLElBQUksS0FBSyxHQUFHLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUM3QixJQUFJLElBQUksU0FBUyxDQUFDLENBQUMsQ0FBQyxZQUFZLE9BQU8sSUFBSSxTQUFTLENBQUMsQ0FBQyxDQUFDLFlBQVksZ0JBQWdCLEVBQUU7QUFDckYsUUFBUSxJQUFJLEdBQUcsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQzVCLFFBQVEsS0FBSyxHQUFHLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUM3QixLQUFLO0FBQ0wsSUFBSSxPQUFPLElBQUksQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDckMsQ0FBQztBQUNEO0FBQ08sU0FBUyxHQUFHLENBQUMsSUFBSSxFQUFFO0FBQzFCLElBQUksT0FBTyxRQUFRLENBQUMsZUFBZSxDQUFDLDRCQUE0QixFQUFFLElBQUksQ0FBQyxDQUFDO0FBQ3hFOztBQ2RBO0FBQ0EsQUFDQTtBQUNBO0FBQ0EsQUFBTyxTQUFTLGNBQWMsQ0FBQyxVQUFVLEVBQUUsR0FBRyxFQUFFO0FBQ2hELElBQUksTUFBTSxjQUFjLEdBQUcsR0FBRyxDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUMsQ0FBQztBQUM1RCxJQUFJLE1BQU0sWUFBWSxHQUFHLEdBQUcsQ0FBQyxhQUFhLENBQUMsV0FBVyxDQUFDLENBQUM7QUFDeEQ7QUFDQSxJQUFJLGNBQWMsQ0FBQyxTQUFTLEdBQUcsRUFBRSxDQUFDO0FB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
